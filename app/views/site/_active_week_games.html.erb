<%= javascript_include_tag('userGameSelectionAjax.js') %>

<div class="row center-align flow-text">
    <div class="col s12">

        <% if @games %>
            <% @games.each_with_index do |g, i| %>
                <div class="row">

                    <div class="col s12 <%= if i % 2 == 0 then 'background' end %>">

                        <div class="row">
                            <div class="col s12">
                                Game <%= i + 1 %>
                                <span class="alert"><%= if g.tiebreaker == true then '(tiebreaker)' end %></span>
                            </div>

                            <!-- DATETIME -->
                            <div class="col s12">
                                <strong><%= game_day(g[:date]) %> <%= convert_military_to_ampm(g[:start_time]) %></strong>
                            </div>

                            <!-- LOCATION -->
                            <div class="col s12">
                                @ <%= g[:location] %>
                            </div>

                            <! -- BREAK -->
                            <div class="col s12"><br/></div>

                            <!-- TEAM MATCHUP -->
                            <div class="row">
                                <strong class="matchup-smaller-font">
                                    <div class="col s5">
                                        <%= g[:away] %>
                                    </div>
                                    <div class="col s2">
                                        vs.
                                    </div>
                                    <div class="col s5">
                                        <%= g[:home] %>
                                    </div>
                                </strong>
                            </div>

                            <!-- AWAY BUTTON/FORM SELECTION -->
                            <div class="col s5">
                                <% if @current_week.locked == true && !@current_week.finalized && g[:game_started] == false %>
                                <form action="" role="form" class="pick" method="POST">
                                    <input type="hidden" value="<%= current_user.id %>" id="user-id">
                                    <input type="hidden" value="<%= g[:id] %>" id="<%= g[:id] %>">
                                    <input type="hidden" value="<%= g[:away] %>" id="away-game-pick-<%= g[:id] %>">
                                    <input type="hidden" value="away" id="away-home">

                                    <button type="submit" name="action" class="game-pick-team-logo-btn">
                                        <%= image_tag g[:away] + '.png', :class => 'responsive-img game-pick-logo' %>
                                    </button>
                                </form>
                                <% else %>
                                    <%= image_tag g[:away] + '.png', :class => 'responsive-img game-pick-logo' %>
                                <% end %>
                            </div>

                            <div class="col s2">
                                <!-- placeholder to match above 'vs.' -->
                                <!-- and -->
                                <!-- temp display of img to indicate successful selection -->
                                <div class="successful-check" id="pick-saved-<%= g[:id] %>" style="visibility: hidden;">
                                    <%= image_tag 'check.png' %>
                                </div>
                            </div>

                            <div class="col s5">
                                <% if @current_week.locked == true && !@current_week.finalized && g[:game_started] == false %>
                                <form action="" role="form" class="pick" method="POST">
                                    <input type="hidden" value="<%= current_user.id %>" id="user-id">
                                    <input type="hidden" value="<%= g[:id] %>" id="<%= g[:id] %>">
                                    <input type="hidden" value="<%= g[:home] %>" id="home-game-pick-<%= g[:id] %>">
                                    <input type="hidden" value="home" id="away-home">

                                    <button type="submit" name="action" class="game-pick-team-logo-btn">
                                        <%= image_tag g[:home] + '.png', :class => 'responsive-img game-pick-logo' %>
                                    </button>
                                </form>
                                <% else %>
                                    <%= image_tag g[:home] + '.png', :class => 'responsive-img game-pick-logo' %>
                                <% end %>
                            </div>

                            <!-- SPREAD -->
                            <div class="col s5 offset-s7 matchup-smaller-font spread">
                                Spread:
                                <strong>
                                    <%= g[:spread] > 0 ? "+" : "" %><%= g[:spread] %>
                                </strong>
                            </div>

                            <!-- CURRENT SCORE -->
                            <% if g[:game_started] == true %>
                                <strong>
                                <div class="col s12">
                                    Current Score:
                                </div>
                                </strong>

                                <div class="col s6">
                                    <strong><%= g[:away_pts] %></strong>
                                </div>
                                <div class="col s6">
                                    <!-- TODO: refactor -->
                                    <!-- TODO: need PUSH conditional as well -->
                                    <% if g[:away_pts] > ( g[:home_pts] + g[:spread] ) %>

                                        <% if @picks[ g[:id] ] == g[:away] %>
                                            <strong style="border: 1px green solid;"><%= g[:home_pts] %></strong>
                                        <% else %>
                                            <strong style="border: 1px red solid;"><%= g[:home_pts] %></strong>
                                        <% end %>

                                    <% else %>

                                        <% if @picks[ g[:id] ] == g[:home] %>
                                            <strong style="border: 1px green solid;"><%= g[:home_pts] %></strong>
                                        <% else %>
                                            <strong style="border: 1px red solid;"><%= g[:home_pts] %></strong>
                                        <% end %>

                                    <% end %>
                                </div>
                            <% end %>

                             <!-- BREAK -->
                            <div class="col s12"><br/></div>

                            <!-- TIEBREAKER -->
                            <% if @current_week.locked == true && !@current_week.finalized %>
                                <% if g[:tiebreaker] == true %>
                                    <% if g[:game_started] == false %>
                                        <div class="col s6 offset-s3 tiebreaker">
                                            <span class="alert">Total Points:</span>
                                            
                                            <input type="hidden" value="<%= current_user.id %>" id="tbreak-user-id">
                                            <input type="hidden" value="<%= g[:id] %>" id="tbreak-game-id">

                                            <input type="number" value="<%= @tbreak_pts %>" id="tbreak-pts" onchange="tiebreaker()" min="0">
                                        </div>
                                    <% end %>
                                <% end %>
                            <% end %>

                            <!-- BREAK -->
                            <div class="col s12"><br/></div>

                            <!-- MAKE SELECTION / YOUR PICK -->
                            <strong>
                                <div class="col s12" id="your-pick-<%= g[:id] %>">
                                    <% if @current_week.locked %>

                                        <% if g[:game_started] == false %>
                                            <% if @picks[ g[:id] ] %>
                                                Current Pick: <%= @picks[ g[:id] ] %>
                                            <% else %>
                                                <span class="make-your-pick">Click Your Pick!</span>
                                            <% end %>
                                        <% else %>
                                            Pick Locked: <%= @picks[ g[:id] ] %>
                                            <br/>
                                            (tiebreaker pts: <%= @tbreak_pts %>)
                                        <% end %>

                                    <% end %>
                                </div>
                            </strong>
                        </div>

                    </div>

                </div>
            <% end %>
        <% end %>

    </div>
</div>